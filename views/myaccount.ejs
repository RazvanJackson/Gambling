<% include ./components/header.ejs %>
<script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>

<div class="columns">
    <div class="column" id="update-app">
        <div class="box">
            <div class="title">User</div>
        </div>
        <div class="box">
            <!-- Email field-->
            <div class="field">
                <label class="label" for="email">Email</label>
                <div class="control">
                    <input class="input" type="text" name="email" index="0" v-model="email" @input="checkEmail()">
                </div>
                <p class="help is-danger email-help" v-if="helpEmail != 'null'">{{helpEmail}}</p>
            </div>

            <!-- Password field-->
            <div class="field">
                <label class="label" for="password">Password</label>
                <div class="control">
                    <input class="input" type="password" name="password" index="2" v-model="password" @input="checkConfirmPassword()">
                </div>
                <p class="help is-danger pasword-help" v-if="helpPassword != 'null'">{{helpPassword}}</p>
            </div>

            <!-- Confirm Password field-->
            <div class="field">
                <label class="label" for="confirmpassword">Confirm Password</label>
                <div class="control">
                    <input class="input" type="password" name="confirmpassword" index="3" v-model="confirmpassword" @input="checkConfirmPassword()">
                </div>
                <p class="help is-danger confirmpassword-help" v-if="helpConfirmPassword != 'null'">{{helpConfirmPassword}}</p>
            </div>

            <!-- SignUp button field-->
            <div class="field">
                <button class="button signup-button" type="submit" @click.self.prevent="update()">Update</button>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="box">
                <div class="title">History</div>
        </div>

        <div class="box history-games-list">
            <div class="columns history-columns">
                <div class="column" id="history-roulette">
                    <div class="history-games">Roulette</div>
                </div>
                <div class="column" id="history-dices">
                    <div class="history-games">Dices</div>
                </div>
                <div class="column" id="history-versus">
                    <div class="history-games">Versus</div>
                </div>
            </div>
        </div>

        <div class="box">
            <div class="columns">
               <div class="column">
                    Game ID
               </div>
               <div class="column">
                    Option
                </div>
                <div class="column">
                    Amount
                </div>
                <div class="column">
                    Winning Color
                </div>
                <div class="column">
                    Result
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const app = new Vue({
    el: '#update-app',
    data: {
        email: undefined,
        password: undefined,
        confirmpassword: undefined,

        helpEmail: undefined,
        helpPassword: undefined,
        helpConfirmPassword: undefined,

        helpSubmit: undefined,
        
        disableBtn: true
    },
    methods:{
        checkEmail(){
            if(app.email == '') app.helpEmail = null;
            else{
                $.post('/user/update-validation',{
                    email:this.email
                },function(data){
                    if(data.error == true){
                        app.helpEmail = data.message;
                        $('.email-help').removeClass('is-primary').addClass('is-danger');
                    } 
                else{
                    app.helpEmail = data.message;
                    $('.email-help').removeClass('is-danger').addClass('is-primary');
                } 
                });
            }
        },
        checkPassword(){
            $.post('/user/update-validation',{
                password: this.password
            },function(data){
                if(data.error == true){
                    app.helpPassword = data.message;
                    $('.password-help').removeClass('is-primary').addClass('is-danger');

                } 
                else{
                    app.helpPassword = data.message;
                    $('.password-help').removeClass('is-danger').addClass('is-primary');
                } 
             });
        },
        checkConfirmPassword(){
            $.post('/user/update-validation',{
                password: this.password,
                confirmpassword: this.confirmpassword
            },function(data){
                if(data.error == true){
                    app.helpConfirmPassword = data.message;
                    $('.confirmpassword-help').removeClass('is-primary').addClass('is-danger');

                } 
                else{
                    app.helpConfirmPassword = data.message;
                    $('.confirmpassword-help').removeClass('is-danger').addClass('is-primary');
                } 
             });
        },
        update(){
            $.post('/user/update',{
                email: this.email,
                password: this.password,
                confirmpassword: this.confirmpassword
            },function(data){
                if(data.error == true){
                    app.helpSubmit = data.message;
                } 
                else{
                    email = null,
                    password = null,
                    confirmpassword = null,
                    app.helpSubmit = data.message;
                } 
             });    
        },
    }
    });
</script>

<style scoped>

.history-games{
    text-align: center;
}

#history-roulette{
    border-radius: 5px 0px 0px 5px;
    background-color: #d51d2a;
    color: white;
}

#history-dices{
    background-color:#60bc39;
    color: white;
}

#history-versus{
    border-radius: 0px 5px 5px 0px;
    background-color: #a72b6b;
    color: white;
}
</style>

<% include ./components/footer.ejs %>